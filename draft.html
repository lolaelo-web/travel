<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Partner Login</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 560px; margin: 40px auto; padding: 0 16px; }
    h1 { margin-bottom: 8px; }
    form { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-top: 16px; }
    label { display:block; font-weight:600; margin: 8px 0 4px; }
    input { width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 12px; padding: 10px 14px; font-size: 16px; cursor: pointer; }
    .muted { color:#666; font-size:14px; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>Partner Login</h1>
  <p class="muted">Enter your email to receive a one-time code. (In dev, the code is returned in the JSON.)</p>

  <form id="requestForm">
    <label for="email">Email</label>
    <input id="email" type="email" required placeholder="you@company.com" />
    <button type="submit">Send code</button>
    <div id="requestMsg" class="muted"></div>
  </form>

  <form id="verifyForm" class="hidden">
    <label for="code">Code</label>
    <input id="code" inputmode="numeric" pattern="[0-9]*" required placeholder="6-digit code" />
    <button type="submit">Verify & Sign in</button>
    <div id="verifyMsg" class="muted"></div>
  </form>

  <script>
    const API = "https://lolaelo-api.onrender.com"; // âœ… your API base

    const requestForm = document.getElementById("requestForm");
    const verifyForm  = document.getElementById("verifyForm");
    const emailEl     = document.getElementById("email");
    const codeEl      = document.getElementById("code");
    const requestMsg  = document.getElementById("requestMsg");
    const verifyMsg   = document.getElementById("verifyMsg");

    requestForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      requestMsg.textContent = "Sending...";
      try {
        const r = await fetch(`${API}/login/request-code`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: emailEl.value.trim() })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || "Request failed");
        // Dev behavior: API returns the code in JSON so you can test without email
        requestMsg.textContent = `Code sent. (Dev hint: ${data.code})`;
        verifyForm.classList.remove("hidden");
        codeEl.focus();
      } catch (err) {
        requestMsg.textContent = `Error: ${err.message}`;
      }
    });

    verifyForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      verifyMsg.textContent = "Verifying...";
      try {
        const r = await fetch(`${API}/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: emailEl.value.trim(), code: codeEl.value.trim() })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || "Verify failed");
        localStorage.setItem("partnerToken", data.token); // store session
        verifyMsg.textContent = "Signed in! Token saved to localStorage.";
        // redirect to your partner photos UI if/when you have it:
        // location.href = "/partners_app.html";
      } catch (err) {
        verifyMsg.textContent = `Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
